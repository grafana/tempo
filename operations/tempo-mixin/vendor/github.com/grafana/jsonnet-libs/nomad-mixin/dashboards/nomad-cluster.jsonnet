{
  grafanaDashboards+:: {
    'nomad-cluster.json':
      {
        annotations: {
          list: [
            {
              builtIn: 1,
              datasource: '-- Grafana --',
              enable: true,
              hide: true,
              iconColor: 'rgba(0, 211, 255, 1)',
              name: 'Annotations & Alerts',
              type: 'dashboard',
            },
          ],
        },
        editable: true,
        graphTooltip: 1,
        id: null,
        iteration: 1624304303697,
        links: [],
        panels: [
          {
            datasource: null,
            fieldConfig: {
              defaults: {},
              overrides: [],
            },
            gridPos: {
              h: 1,
              w: 24,
              x: 0,
              y: 0,
            },
            id: 24,
            title: 'Allocations',
            type: 'row',
          },
          {
            cacheTimeout: null,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                color: {
                  mode: 'thresholds',
                },
                mappings: [],
                max: 100,
                min: 0,
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                    {
                      color: 'yellow',
                      value: 80,
                    },
                    {
                      color: 'red',
                      value: 90,
                    },
                  ],
                },
                unit: 'percent',
              },
              overrides: [],
            },
            gridPos: {
              h: 5,
              w: 5,
              x: 0,
              y: 1,
            },
            id: 33,
            interval: null,
            links: [],
            maxDataPoints: 100,
            options: {
              orientation: 'horizontal',
              reduceOptions: {
                calcs: [
                  'lastNotNull',
                ],
                fields: '',
                values: false,
              },
              showThresholdLabels: false,
              showThresholdMarkers: true,
              text: {},
            },
            pluginVersion: '8.0.2',
            repeat: 'instance',
            repeatDirection: 'v',
            targets: [
              {
                expr: 'nomad_client_allocated_cpu{datacenter="$datacenter", instance="$instance"}/(nomad_client_unallocated_cpu{datacenter="$datacenter", instance="$instance"}+nomad_client_allocated_cpu{datacenter="$datacenter", instance="$instance"})*100',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '',
                refId: 'A',
              },
            ],
            title: 'CPU allocated',
            description: 'CPU allocated on $instance',
            type: 'gauge',
          },
          {
            cacheTimeout: null,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                color: {
                  mode: 'thresholds',
                },
                mappings: [],
                max: 100,
                min: 0,
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                    {
                      color: 'yellow',
                      value: 80,
                    },
                    {
                      color: 'red',
                      value: 90,
                    },
                  ],
                },
                unit: 'percent',
              },
              overrides: [],
            },
            gridPos: {
              h: 5,
              w: 5,
              x: 5,
              y: 1,
            },
            id: 40,
            interval: null,
            links: [],
            maxDataPoints: 100,
            options: {
              orientation: 'horizontal',
              reduceOptions: {
                calcs: [
                  'lastNotNull',
                ],
                fields: '',
                values: false,
              },
              showThresholdLabels: false,
              showThresholdMarkers: true,
              text: {},
            },
            pluginVersion: '8.0.2',
            repeat: 'instance',
            repeatDirection: 'v',
            targets: [
              {
                expr: 'nomad_client_allocated_memory{datacenter="$datacenter", instance="$instance"}/(nomad_client_unallocated_memory{datacenter="$datacenter", instance="$instance"}+nomad_client_allocated_memory{datacenter="$datacenter", instance="$instance"})*100',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '',
                refId: 'A',
              },
            ],
            title: 'Memory allocated',
            description: 'Memory allocated on $instance',
            type: 'gauge',
          },
          {
            cacheTimeout: null,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                color: {
                  mode: 'thresholds',
                },
                decimals: 2,
                mappings: [],
                max: 100,
                min: 0,
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                    {
                      color: 'yellow',
                      value: 80,
                    },
                    {
                      color: 'red',
                      value: 90,
                    },
                  ],
                },
                unit: 'percent',
              },
              overrides: [],
            },
            gridPos: {
              h: 5,
              w: 5,
              x: 10,
              y: 1,
            },
            id: 48,
            interval: null,
            links: [],
            maxDataPoints: 100,
            options: {
              orientation: 'horizontal',
              reduceOptions: {
                calcs: [
                  'lastNotNull',
                ],
                fields: '',
                values: false,
              },
              showThresholdLabels: false,
              showThresholdMarkers: true,
              text: {},
            },
            pluginVersion: '8.0.2',
            repeat: 'instance',
            repeatDirection: 'v',
            targets: [
              {
                expr: 'nomad_client_allocated_disk{datacenter="$datacenter", instance="$instance"}/(nomad_client_unallocated_disk{datacenter="$datacenter", instance="$instance"}+nomad_client_allocated_disk{datacenter="$datacenter", instance="$instance"})*100',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '',
                refId: 'A',
              },
            ],
            title: 'Disk allocated',
            description: 'Disk allocated on $instance',
            type: 'gauge',
          },
          {
            id: 58,
            gridPos: {
              h: 5,
              w: 9,
              x: 15,
              y: 1,
            },
            type: 'state-timeline',
            title: 'Summary',
            repeat: 'instance',
            repeatDirection: 'v',
            datasource: {
              uid: '${datasource}',
              type: 'prometheus',
            },
            links: [],
            fieldConfig: {
              defaults: {
                custom: {
                  lineWidth: 1,
                  fillOpacity: 70,
                  spanNulls: false,
                },
                color: {
                  mode: 'continuous-GrYlRd',
                },
                mappings: [],
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                  ],
                },
                unit: 'allocs',
              },
              overrides: [],
            },
            options: {
              mergeValues: true,
              showValue: 'auto',
              alignValue: 'left',
              rowHeight: 0.95,
              legend: {
                displayMode: 'hidden',
                placement: 'bottom',
              },
              tooltip: {
                mode: 'single',
                sort: 'none',
              },
            },
            targets: [
              {
                expr: 'sum by (datacenter) (nomad_client_allocations_migrating{datacenter=~"$datacenter", instance="$instance"})',
                legendFormat: 'Migrating',
                interval: '',
                exemplar: true,
                datasource: {
                  type: 'prometheus',
                  uid: '${datasource}',
                },
                format: 'time_series',
                intervalFactor: 1,
                refId: 'A',
              },
              {
                expr: 'sum by (datacenter) (nomad_client_allocations_blocked{datacenter=~"$datacenter", instance="$instance"})',
                legendFormat: 'Blocked',
                interval: '',
                exemplar: true,
                datasource: {
                  type: 'prometheus',
                  uid: '${datasource}',
                },
                format: 'time_series',
                intervalFactor: 1,
                refId: 'B',
              },
              {
                expr: 'sum by (datacenter) (nomad_client_allocations_pending{datacenter=~"$datacenter", instance="$instance"})',
                legendFormat: 'Pending',
                interval: '',
                exemplar: true,
                datasource: {
                  type: 'prometheus',
                  uid: '${datasource}',
                },
                format: 'time_series',
                intervalFactor: 1,
                refId: 'C',
              },
              {
                datasource: {
                  type: 'prometheus',
                  uid: '${datasource}',
                },
                exemplar: true,
                expr: 'sum by (datacenter)  (nomad_client_allocations_running{datacenter=~"$datacenter", instance=~"$instance"})',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Running',
                refId: 'D',
              },
              {
                datasource: {
                  type: 'prometheus',
                  uid: '${datasource}',
                },
                exemplar: true,
                expr: 'sum by (datacenter)  (nomad_client_allocations_terminal{datacenter=~"$datacenter", instance=~"$instance"})',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Terminal',
                refId: 'E',
              },
            ],
            interval: null,
          },
          {
            datasource: null,
            fieldConfig: {
              defaults: {},
              overrides: [],
            },
            gridPos: {
              h: 1,
              w: 24,
              x: 0,
              y: 6,
            },
            id: 2,
            title: 'Nomad clients',
            type: 'row',
          },
          {
            cacheTimeout: null,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                color: {
                  mode: 'thresholds',
                },
                decimals: 1,
                mappings: [],
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                    {
                      color: 'red',
                      value: 80,
                    },
                  ],
                },
                unit: 'dtdurations',
              },
              overrides: [],
            },
            gridPos: {
              h: 5,
              w: 4,
              x: 0,
              y: 7,
            },
            id: 4,
            interval: null,
            links: [],
            maxDataPoints: 100,
            options: {
              colorMode: 'none',
              graphMode: 'none',
              justifyMode: 'auto',
              orientation: 'horizontal',
              reduceOptions: {
                calcs: [
                  'lastNotNull',
                ],
                fields: '',
                values: false,
              },
              text: {},
              textMode: 'auto',
            },
            pluginVersion: '8.0.2',
            repeat: 'instance',
            repeatDirection: 'v',
            targets: [
              {
                expr: 'nomad_client_uptime{datacenter="$datacenter", instance="$instance"}',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '',
                refId: 'A',
              },
            ],
            title: 'Uptime',
            type: 'stat',
          },
          {
            cacheTimeout: null,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                color: {
                  mode: 'thresholds',
                },
                mappings: [],
                max: 100,
                min: 0,
                thresholds: {
                  mode: 'absolute',
                  steps: [
                    {
                      color: 'green',
                      value: null,
                    },
                    {
                      color: 'yellow',
                      value: 80,
                    },
                    {
                      color: 'red',
                      value: 90,
                    },
                  ],
                },
                unit: 'percent',
              },
              overrides: [],
            },
            gridPos: {
              h: 5,
              w: 5,
              x: 4,
              y: 7,
            },
            id: 7,
            interval: null,
            links: [],
            maxDataPoints: 100,
            options: {
              orientation: 'horizontal',
              reduceOptions: {
                calcs: [
                  'lastNotNull',
                ],
                fields: '',
                values: false,
              },
              showThresholdLabels: false,
              showThresholdMarkers: true,
              text: {},
            },
            pluginVersion: '8.0.2',
            repeat: 'instance',
            repeatDirection: 'v',
            targets: [
              {
                expr: '100-sum(nomad_client_host_cpu_idle{datacenter="$datacenter", instance="$instance"}) / count(nomad_client_host_cpu_idle{datacenter="$datacenter", instance="$instance"})',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '',
                refId: 'A',
              },
            ],
            title: 'CPU usage',
            type: 'gauge',
          },
          {
            aliasColors: {},
            bars: false,
            dashLength: 10,
            dashes: false,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                links: [],
              },
              overrides: [],
            },
            fill: 1,
            fillGradient: 0,
            gridPos: {
              h: 5,
              w: 5,
              x: 9,
              y: 7,
            },
            hiddenSeries: false,
            id: 11,
            legend: {
              avg: false,
              current: false,
              max: false,
              min: false,
              show: true,
              total: false,
              values: false,
            },
            lines: true,
            linewidth: 1,
            links: [],
            nullPointMode: 'null',
            options: {
              alertThreshold: true,
            },
            percentage: false,
            pluginVersion: '8.0.2',
            pointradius: 5,
            points: false,
            renderer: 'flot',
            repeat: 'instance',
            repeatDirection: 'v',
            seriesOverrides: [],
            spaceLength: 10,
            stack: false,
            steppedLine: false,
            targets: [
              {
                expr: 'nomad_client_host_memory_total{datacenter="$datacenter", instance="$instance"}',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Total',
                refId: 'B',
              },
              {
                expr: 'nomad_client_host_memory_free{datacenter="$datacenter", instance="$instance"}',
                format: 'time_series',
                instant: false,
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Free',
                refId: 'A',
              },
              {
                expr: 'nomad_client_host_memory_used{datacenter="$datacenter", instance="$instance"}',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Used',
                refId: 'C',
              },
              {
                expr: 'nomad_client_host_memory_available{datacenter="$datacenter", instance="$instance"}',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Available',
                refId: 'D',
              },
            ],
            thresholds: [],
            timeFrom: null,
            timeRegions: [],
            timeShift: null,
            title: 'Memory',
            tooltip: {
              shared: true,
              sort: 0,
              value_type: 'individual',
            },
            type: 'graph',
            xaxis: {
              buckets: null,
              mode: 'time',
              name: null,
              show: true,
              values: [],
            },
            yaxes: [
              {
                format: 'decbytes',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: true,
              },
              {
                format: 'short',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: true,
              },
            ],
            yaxis: {
              align: false,
              alignLevel: null,
            },
          },
          {
            aliasColors: {},
            bars: false,
            dashLength: 10,
            dashes: false,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                links: [],
              },
              overrides: [],
            },
            fill: 1,
            fillGradient: 0,
            gridPos: {
              h: 5,
              w: 5,
              x: 14,
              y: 7,
            },
            hiddenSeries: false,
            id: 13,
            legend: {
              avg: false,
              current: false,
              max: false,
              min: false,
              show: true,
              total: false,
              values: false,
            },
            lines: true,
            linewidth: 1,
            links: [],
            nullPointMode: 'null',
            options: {
              alertThreshold: true,
            },
            percentage: false,
            pluginVersion: '8.0.2',
            pointradius: 5,
            points: false,
            renderer: 'flot',
            repeat: 'instance',
            repeatDirection: 'v',
            seriesOverrides: [],
            spaceLength: 10,
            stack: false,
            steppedLine: false,
            targets: [
              {
                expr: 'max(nomad_client_host_disk_size{datacenter="$datacenter", instance="$instance"}) by (disk)',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Total - {{disk}}',
                refId: 'B',
              },
              {
                expr: 'avg(nomad_client_host_disk_available{datacenter="$datacenter", instance="$instance"}) by (disk)',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: 'Available - {{disk}}',
                refId: 'A',
              },
            ],
            thresholds: [],
            timeFrom: null,
            timeRegions: [],
            timeShift: null,
            title: 'Disk usage',
            tooltip: {
              shared: true,
              sort: 0,
              value_type: 'individual',
            },
            type: 'graph',
            xaxis: {
              buckets: null,
              mode: 'time',
              name: null,
              show: true,
              values: [],
            },
            yaxes: [
              {
                decimals: 0,
                format: 'decbytes',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: true,
              },
              {
                format: 'decbytes',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: false,
              },
            ],
            yaxis: {
              align: false,
              alignLevel: null,
            },
          },
          {
            aliasColors: {},
            bars: false,
            dashLength: 10,
            dashes: false,
            datasource: '$datasource',
            fieldConfig: {
              defaults: {
                links: [],
              },
              overrides: [],
            },
            fill: 1,
            fillGradient: 0,
            gridPos: {
              h: 5,
              w: 5,
              x: 19,
              y: 7,
            },
            hiddenSeries: false,
            id: 15,
            legend: {
              avg: false,
              current: false,
              max: false,
              min: false,
              show: true,
              total: false,
              values: false,
            },
            lines: true,
            linewidth: 1,
            links: [],
            nullPointMode: 'null',
            options: {
              alertThreshold: true,
            },
            percentage: false,
            pluginVersion: '8.0.2',
            pointradius: 5,
            points: false,
            renderer: 'flot',
            repeat: 'instance',
            repeatDirection: 'v',
            seriesOverrides: [],
            spaceLength: 10,
            stack: false,
            steppedLine: false,
            targets: [
              {
                expr: 'avg(nomad_client_host_disk_inodes_percent{datacenter="$datacenter", instance="$instance"}) by (disk)',
                format: 'time_series',
                interval: '',
                intervalFactor: 1,
                legendFormat: '{{disk}}',
                refId: 'A',
              },
            ],
            thresholds: [],
            timeFrom: null,
            timeRegions: [],
            timeShift: null,
            title: 'Disk inodes',
            tooltip: {
              shared: true,
              sort: 0,
              value_type: 'individual',
            },
            type: 'graph',
            xaxis: {
              buckets: null,
              mode: 'time',
              name: null,
              show: true,
              values: [],
            },
            yaxes: [
              {
                decimals: null,
                format: 'percent',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: true,
              },
              {
                format: 'short',
                label: null,
                logBase: 1,
                max: null,
                min: null,
                show: true,
              },
            ],
            yaxis: {
              align: false,
              alignLevel: null,
            },
          },
        ],
        refresh: '1m',
        schemaVersion: 30,
        style: 'dark',
        tags: $._config.dashboardTags,
        templating: {
          list: [
            {
              current: {},
              description: null,
              'error': null,
              hide: 0,
              includeAll: false,
              label: 'Data Source',
              multi: false,
              name: 'datasource',
              options: [],
              query: 'prometheus',
              refresh: 1,
              regex: '',
              skipUrlSync: false,
              type: 'datasource',
            },
            {
              allValue: null,
              current: {},
              datasource: {
                type: 'prometheus',
                uid: '${datasource}',
              },
              definition: '',
              description: null,
              'error': null,
              hide: 0,
              includeAll: false,
              label: 'DC',
              multi: false,
              name: 'datacenter',
              options: [],
              query: {
                query: 'label_values(nomad_client_uptime, datacenter)',
                refId: 'prometheus-datacenter-Variable-Query',
              },
              refresh: 1,
              regex: '',
              skipUrlSync: false,
              sort: 0,
              tagValuesQuery: '',
              tagsQuery: '',
              type: 'query',
              useTags: false,
            },
            {
              allValue: null,
              current: {},
              datasource: {
                type: 'prometheus',
                uid: '${datasource}',
              },
              definition: 'label_values(nomad_client_uptime{datacenter="$datacenter"}, instance)',
              description: null,
              'error': null,
              hide: 0,
              includeAll: true,
              label: 'Nomad client',
              multi: true,
              name: 'instance',
              options: [],
              query: {
                query: 'label_values(nomad_client_uptime{datacenter="$datacenter"}, instance)',
                refId: 'prometheus-instance-Variable-Query',
              },
              refresh: 1,
              regex: '',
              skipUrlSync: false,
              sort: 0,
              tagValuesQuery: '',
              tagsQuery: '',
              type: 'query',
              useTags: false,
            },
          ],
        },
        time: {
          from: 'now-15m',
          to: 'now',
        },
        timepicker: {
          refresh_intervals: [
            '5s',
            '10s',
            '30s',
            '1m',
            '5m',
            '15m',
            '30m',
            '1h',
            '2h',
            '1d',
          ],
          time_options: [
            '5m',
            '15m',
            '1h',
            '6h',
            '12h',
            '24h',
            '2d',
            '7d',
            '30d',
          ],
        },
        timezone: '',
        title: 'Nomad cluster',
        uid: 'CiP3mZVik',
        version: 1,
      },

  },
}
