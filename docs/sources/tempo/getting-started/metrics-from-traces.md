---
title: Metrics from traces
description: Learn about how we can correlate traces and metrics.
weight: 700
---

# Metrics from traces

Grafana Tempo can generate metrics from tracing data using the metrics-generator, the metricsSummary API, and TraceQL metrics.

The metrics-generator generates metrics from tracing data using the `services_graphs`, `span_metrics`, and `local_blocks` processors. The `local_blocks` processor is required for TraceQL metrics.
The metrics-generator processes spans and write metrics using the Prometheus remote write protocol.

The metricsSummary API returns RED metrics for `kind=server` spans sent to Tempo in the last hour.
metricsSummary creates metrics from trace data without using metrics-generator.
This API is being deprecated in favor of TraceQL metrics.

TraceQL metrics, powered by the API of the same name, return Prometheus-like time series for a given metrics query.
Metrics queries apply a function to trace query results.
TraceQL metrics uses the `local_blocks` processor in metrics-generator.

## Metrics-generator

Tempo can generate metrics from ingested traces using the metrics-generator, an optional Tempo component. The metrics-generator runs two different processors: [service graphs](https://grafana.com/docs/tempo/<TEMPO_VERSION>/metrics-generator/service_graphs/) and [span metrics](https://grafana.com/docs/tempo/<TEMPO_VERSION>/metrics-generator/span_metrics).

Metrics generated by the metrics-generator can provide both RED (Rate/Error/Duration) metrics and interdependency graphs between services in a trace (the Service Graph functionality in Grafana).
These capabilities rely on a set of generated span metrics and service metrics.

RED metrics represent:

- Rate, the number of requests per second
- Errors, the number of those requests that are failing
- Duration, the amount of time those requests take

The metrics-generator looks at incoming spans, and calculates RED metrics from them, which it then writes to a time series database like Prometheus.
By querying Prometheus, you can see the overall request rate, erroring request rate, and distribution of request latency in your system.
By using the labels on those metrics, you can get a more granular view of request rate, error rate, and latency at a per-service, per-namespace, or per-operation level.

For more information about RED method, refer to [The RED Method: How to instrument your services](/blog/2018/08/02/the-red-method-how-to-instrument-your-services/).

### Use-cases for span metrics

The metrics-generator processes spans and writes metrics to a Prometheus data source using the Prometheus remote write protocol.

Span metrics are of particular interest if your system isn't monitored with metrics but it has distributed tracing implemented. You get out-of-the-box metrics from your tracing pipeline.

{{< admonition type="note" >}}
In Grafana Cloud, the metrics-generator is disabled by default. Contact Grafana Support to enable metrics generation in your organization.
{{< /admonition >}}

After the metrics-generator is enabled in your organization, refer to [Metrics-generator configuration](https://grafana.com/docs/tempo/<TEMPO_VERSION>/configuration/#metrics-generator) for information about metrics-generator options.

![Trace service graph](/media/docs/grafana/data-sources/tempo/query-editor/tempo-ds-query-service-graph.png)

These metrics exist in your Hosted Metrics instance and can also be easily used to generate powerful custom dashboards.

<p align="center"><img src="../assets/trace_custom_metrics_dash.png" alt="Trace custom metrics dashboard"></p>

The metrics-generator automatically generates exemplars as well which allows easy metrics to trace linking.
[Exemplars](https://grafana.com/docs/grafana/<GRAFANA_VERSION>/fundamentals/exemplars/) are available in Grafana Cloud so you can also push your own.

<p align="center"><img src="../assets/trace_exemplars.png" alt="Trace exemplars"></p>

## Metrics summary API (deprecated)

The metrics summary API was one of the first capabilities for generating ad hoc RED metrics at query time in Tempo.
This data was displayed in the Aggregate by table in Grafana Explore, where you could see request rate, error rate, and latency values of your system over the last hour, computed from your trace data.
Those values were broken down by any and all attributes attached to your traces.

When you used the “Aggregate by” option, Grafana made a call to Tempo’s metrics summary API, which returns these RED metrics based on spans of `kind=server` seen in the last hour.

Refer to [Traces to metrics: Ad hoc RED metrics in Grafana Tempo with 'Aggregate by'](https://grafana.com/blog/2023/12/07/traces-to-metrics-ad-hoc-red-metrics-in-grafana-tempo-with-aggregate-by/) for more information about metrics summary API.

The metrics summary API and the Aggregate by table have been deprecated in favor of TraceQL metrics.
For more information, refer to [Deprecation in favor of TraceQL metrics](https://grafana.com/docs/tempo/<TEMPO_VERSION>/api_docs/metrics-summary/#deprecation-in-favor-of-traceql-metrics).

## TraceQL metrics (experimental)

Traces are a unique observability signal that contain causal relationships between the components in your system.

- Do you want to know how many database calls across all systems are downstream of your application?
- What services beneath a given endpoint are currently failing?
- What services beneath an endpoint are currently slow?

The experimental TraceQL metrics can answer all these questions by parsing your traces in aggregate.

You can query data generated by TraceQL metrics in a similar way that you would query results stored in Prometheus, Grafana Mimir, or other Prometheus-compatible Time-Series-Database (TSDB).
TraceQL metrics queries allows you to calculate metrics on trace span data on-the-fly with Tempo (your tracing database), without requiring a time-series-database like Prometheus.

Refer to these resources for additional information:

- [Solves problems with TraceQL metrics queries](https://grafana.com/docs/tempo/<TEMPO_VERSION>/traceql/metrics-queries/solve-problems-metrics-queries/)
- [Configure TraceQL metrics](https://grafana.com/docs/tempo/<TEMPO_VERSION>/operations/traceql-metrics/)
- [TraceQL metrics queries](https://grafana.com/docs/tempo/<TEMPO_VERSION>/traceql/metrics-queries/)
- [TraceQL metrics functions](https://grafana.com/docs/tempo/<TEMPO_VERSION>/traceql/metrics-queries/functions/)
