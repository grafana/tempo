---
title: Amazon S3 permissions and management
menuTitle: Amazon S3
description: Amazon S3 permissions and configuration options for Tempo.
aliases:
  - ../../configuration/s3/ # /docs/tempo/<TEMPO_VERSION>/configuration/s3/
---

# Amazon S3 permissions and management

Tempo supports Amazon S3 for both monolithic and distributed modes.
Some of the supported features include:

- Object layout: custom `bucket` and optional `prefix` to nest objects in a shared bucket.
- Performance: hedged requests (`hedge_requests_at`, `hedge_requests_up_to`) to reduce long-tail latency.
- S3-compatible endpoints and addressing styles: configurable `endpoint`, `forcepathstyle`, and `bucket_lookup_type`. Dual-stack DNS via `enable_dual_stack`.
- Local development: S3-compatible storage such as MinIO.

For configuration options, refer to the storage section on the [configuration](../../#storage) page.

The following authentication methods are supported:

- AWS environment variables `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY`
- Static access key and secret credentials specified in `access_key` and `secret_key`
- MinIO environment variables `MINIO_ACCESS_KEY` and `MINIO_SECRET_KEY`
- AWS shared credentials [configuration file](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/
  create-shared-credentials-file.html)
- MinIO client credentials [configuration file](https://github.com/minio/mc/blob/master/docs/minio-client-configuration-files.
  md)
- AWS IAM ([IRSA via WebIdentity](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html)
- AWS [EC2 instance role](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html)
- AWS [EKS Pod Identity](https://docs.aws.amazon.com/eks/latest/userguide/pod-identities.html)

## Before you begin

Tempo requires the following configuration to authenticate to and access Amazon S3:

- S3 `bucket` name.
- Credentials provided via one of the supported authentication methods listed above.
- For S3-compatible providers (including MinIO), set the `endpoint` and any addressing options (`forcepathstyle`, `bucket_lookup_type`) according to the provider's requirements.

For all configuration keys, refer to the storage section on the [configuration](../../#storage) page.

## Sample configuration for Tempo monolithic mode

Update the values in this configuration to match your S3 bucket and credentials.

```yaml
tempo:
  storage:
    trace:
      backend: s3
      s3:
        bucket: your-bucket-name
        # Optional settings
        # prefix: tempo
        # region: us-east-1
        # endpoint: s3.dualstack.us-east-2.amazonaws.com
        # forcepathstyle: false
        # enable_dual_stack: false
        # list_blocks_concurrency: 3
        # hedge_requests_at: 500ms
        # hedge_requests_up_to: 2
        # tls_min_version: VersionTLS12
        # tags:
        #   env: prod
        # sse:
        #   type: SSE-S3
        #   kms_key_id: "1234abcd-12ab-34cd-5xef-4443322111"

  # Provide credentials via environment variables if not using a node/role-based method
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY
    # - name: AWS_SESSION_TOKEN
    #   valueFrom:
    #     secretKeyRef:
    #       name: aws-creds
    #       key: AWS_SESSION_TOKEN
```

## Sample configuration for Tempo distributed mode

Provide credentials to each service when not using role-based authentication.
Update the values in this configuration to match your S3 bucket and credentials.

```yaml
storage:
  trace:
    backend: s3
    s3:
      bucket: your-bucket-name
      # prefix: tempo
      # region: us-east-1

distributor:
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY

compactor:
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY

ingester:
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY

querier:
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY

queryFrontend:
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: aws-creds
          key: AWS_SECRET_ACCESS_KEY
```

## Additional configuration options

### Use MinIO or S3-compatible storage for local development

You can test Tempo locally against an S3-compatible provider such as MinIO.
Set the `endpoint`, `insecure` when using `http://`, and configure addressing style if required by the provider.

```yaml
storage:
  trace:
    backend: s3
    s3:
      bucket: tempo
      endpoint: http://minio.minio.svc.cluster.local:9000
      region: us-east-1
      access_key: minioadmin
      secret_key: minioadmin
      forcepathstyle: true
```

### S3 endpoints and bucket addressing

- `endpoint`: Override to use a specific AWS region endpoint or an S3-compatible provider.
- `region`: Required by some S3-compatible providers.
- `forcepathstyle`: Enable path-style requests if the provider doesn't support virtual-hosted style.
- `bucket_lookup_type`: Control lookup mode for S3-compatible clients. Tempo ignores this option when `forcepathstyle` is true.
- `enable_dual_stack`: Use dual-stack endpoints for DNS resolution.

### Performance tuning

- Hedge requests: Set `hedge_requests_at` and optionally `hedge_requests_up_to` to reduce long-tail latency (most effective on queriers).
- Listing concurrency: Adjust `list_blocks_concurrency` (default 3) to balance speed and resource usage during blocklist polling.

### Object tagging and server-side encryption (SSE)

```yaml
s3:
  tags:
    env: prod
    owner: observability
  sse:
    type: SSE-S3
    # Or use SSE-KMS with a KMS key ID
    # type: SSE-KMS
    # kms_key_id: "1234abcd-12ab-34cd-56ef-1234567890ab"
    # kms_encryption_context: '{"department":"10103.0"}'
```

## Troubleshooting

- 403 or SignatureDoesNotMatch: Ensure `region` matches the bucket's region and that credentials are valid.
- 301 Moved Permanently when accessing a bucket: Region mismatch; set the correct `region`.
- DNS or addressing errors: Try `forcepathstyle: true` or adjust `bucket_lookup_type` for S3-compatible providers.
- TLS errors with custom endpoints: Set `insecure: true` for `http://` endpoints, or configure `tls_*` settings for custom certificate authorities.

## Permissions

The following IAM policy shows minimal permissions required by Tempo, where the bucket has already been created.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "TempoPermissions",
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:ListBucket",
        "s3:DeleteObject",
        "s3:GetObjectTagging",
        "s3:PutObjectTagging"
      ],
      "Resource": ["arn:aws:s3:::<bucketname>/*", "arn:aws:s3:::<bucketname>"]
    }
  ]
}
```

## Lifecycle policy

A lifecycle policy is recommended that deletes incomplete multipart uploads after one day.
