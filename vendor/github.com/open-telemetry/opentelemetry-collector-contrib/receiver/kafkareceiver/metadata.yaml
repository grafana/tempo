type: kafka

status:
  class: receiver
  stability:
    beta: [metrics, logs, traces]
  distributions:
  - core
  - contrib
  codeowners:
    active: [pavolloffay, MovieStoreGuy, axw]

# TODO: Update the receiver to pass the tests
tests:
  skip_lifecycle: true
  goleak:
    ignore:
      top:
        - github.com/twmb/franz-go/pkg/kfake.(*group).manage

attributes:
  topic:
    description: The Kafka topic.
    type: string
  partition:
    description: The Kafka topic partition.
    type: int
  node_id:
    description: The Kafka node ID.
    type: int
  outcome:
    description: The operation outcome.
    type: string
    enum: [success, failure]

telemetry:
  metrics:
    kafka_broker_connects:
      enabled: true
      description: The total number of connections opened.
      extended_documentation: Only produced when franz-go is enabled.
      optional: true
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id, outcome]
    kafka_broker_closed:
      enabled: true
      description: The total number of connections closed.
      extended_documentation: Only produced when franz-go is enabled.
      optional: true
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id]
    kafka_broker_throttling_duration:
      enabled: true
      stability:
        level: deprecated
      description: The throttling duration in ms imposed by the broker when receiving messages.
      extended_documentation: Only produced when franz-go is enabled. Deprecated in favor of kafka_broker_throttling_latency.
      optional: true
      unit: ms
      histogram:
        value_type: int
      attributes: [node_id]
      warnings:
        if_enabled: This metric is deprecated in favor of kafka_broker_throttling_latency and will be removed soon.
    kafka_broker_throttling_latency:
      enabled: true
      description: The throttling latency in seconds imposed by the broker when receiving records.
      extended_documentation: Only produced when franz-go is enabled.
      optional: true
      unit: s
      histogram:
        value_type: double
        bucket_boundaries: [0, 0.005, 0.010, 0.025, 0.050, 0.075, 0.100, 0.250, 0.500, 0.750, 1, 2.5, 5, 7.5, 10, 25, 50, 75, 100]
      attributes: [node_id]
    kafka_receiver_messages:
      enabled: true
      stability:
        level: deprecated
      description: The number of received messages.
      extended_documentation: Deprecated in favor of kafka_receiver_records.
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id, topic, partition, outcome]
      warnings:
        if_enabled: This metric is deprecated in favor of kafka_receiver_records and will be removed soon.
    kafka_receiver_records:
      enabled: true
      description: The number of received records.
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id, topic, partition, outcome]
    kafka_receiver_bytes:
      enabled: true
      description: The size in bytes of received records seen by the broker.
      extended_documentation: Only produced when franz-go is enabled.
      optional: true
      unit: By
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id, topic, partition, outcome]
    kafka_receiver_bytes_uncompressed:
      enabled: true
      description: The uncompressed size in bytes of received records seen by the client.
      unit: By
      sum:
        value_type: int
        monotonic: true
      attributes: [node_id, topic, partition, outcome]
    kafka_receiver_latency:
      enabled: true
      stability:
        level: deprecated
      description: The time it took in ms to receive a batch of messages.
      extended_documentation: Only produced when franz-go is enabled. Deprecated in favor of kafka_receiver_read_latency.
      unit: ms
      histogram:
        value_type: int
      attributes: [node_id, topic, partition, outcome]
      warnings:
        if_enabled: This metric is deprecated in favor of kafka_receiver_read_latency and will be removed soon.
    kafka_receiver_read_latency:
      enabled: true
      description: The time it took in seconds to receive a batch of records.
      extended_documentation: Only produced when franz-go is enabled.
      unit: s
      histogram:
        value_type: double
        bucket_boundaries: [0, 0.005, 0.010, 0.025, 0.050, 0.075, 0.100, 0.250, 0.500, 0.750, 1, 2.5, 5, 7.5, 10, 25, 50, 75, 100]
      attributes: [node_id, topic, partition, outcome]
    kafka_receiver_records_delay:
      enabled: true
      optional: true
      description: The time in seconds between producing and receiving a batch of records.
      extended_documentation: |
        Optional, only reported when enabled via config.
        Note that this metric may slow down high-volume consuming.
        Only produced when franz-go is enabled.
        This metric is reported with an assumption that the exporter and the receiver clocks are synchronized.
      unit: s
      histogram:
        value_type: double
        bucket_boundaries: [0, 0.005, 0.010, 0.025, 0.050, 0.075, 0.100, 0.250, 0.500, 0.750, 1, 2.5, 5, 7.5, 10, 25, 50, 75, 100, 250, 500, 750, 1000, 2500, 5000, 7500, 10000]
      attributes: [topic, partition]
    kafka_receiver_current_offset:
      enabled: true
      description: Current message offset
      unit: "1"
      gauge:
        value_type: int
      attributes: [topic, partition]
    kafka_receiver_offset_lag:
      enabled: true
      description: Current offset lag
      unit: "1"
      gauge:
        value_type: int
      attributes: [topic, partition]
    kafka_receiver_partition_start:
      enabled: true
      description: Number of started partitions
      unit: "1"
      sum:
        value_type: int
        monotonic: true
    kafka_receiver_partition_close:
      enabled: true
      description: Number of finished partitions
      unit: "1"
      sum:
        value_type: int
        monotonic: true
    kafka_receiver_unmarshal_failed_metric_points:
      enabled: true
      description: Number of metric points failed to be unmarshaled
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [topic, partition]
    kafka_receiver_unmarshal_failed_log_records:
      enabled: true
      description: Number of log records failed to be unmarshaled
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [topic, partition]
    kafka_receiver_unmarshal_failed_spans:
      enabled: true
      description: Number of spans failed to be unmarshaled
      unit: "1"
      sum:
        value_type: int
        monotonic: true
      attributes: [topic, partition]
